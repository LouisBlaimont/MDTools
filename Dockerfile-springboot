# Stage 2: Build Spring Boot app
FROM maven:3.8.5-openjdk-17 AS spring-builder

# Set working directory
WORKDIR /app

# Copy the Svelte build output to Spring Boot's static resources
COPY --from=svelte-builder /app/build backend/src/main/resources/static

# Package the Spring Boot application
RUN mvn -f backend/pom.xml clean package -DskipTests

# Expose the default Spring Boot port
EXPOSE 8080

# Run the Spring Boot application
ENTRYPOINT ["java", "-jar", "app.jar"]